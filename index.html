<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mister Coderz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="MISTER CODERZ (1).png" type="image/x-icon">
<style>
.popup{
  position:fixed;top:20px;right:20px;
  background:#4caf50;color:white;
  padding:12px 18px;border-radius:6px;
  font-size:14px;display:none;z-index:999
}
.popup.error{background:#f44336}

body{
  font-family:Segoe UI,Tahoma;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;display:flex;
  align-items:center;justify-content:center
}
.container{
  background:#fff;width:500px;
  padding:30px;border-radius:12px
}
h1{text-align:center;margin-bottom:10px}
.helper{text-align:center;color:#666;font-size:14px;margin-bottom:20px}
label{font-weight:600;margin-top:15px;display:block}
textarea,input{
  width:100%;padding:10px;margin-top:6px;
  border-radius:6px;border:2px solid #ddd
}
button{
  width:100%;margin-top:12px;padding:12px;
  background:#667eea;color:#fff;border:none;
  border-radius:6px;font-weight:bold;cursor:pointer
}
button:hover{background:#764ba2}
#codeBox{
  margin-top:10px;border:2px dashed #667eea;
  padding:15px;text-align:center;
  font-weight:bold;cursor:pointer
}
.progress{
  height:6px;background:#eee;border-radius:10px;
  margin-top:10px;overflow:hidden
}
.progress div{
  height:100%;width:0;background:#667eea
}
.status{text-align:center;font-size:13px;margin-top:8px}
</style>
</head>

<body>

<div class="container">
<h1>Online Clipboard</h1>
<p class="helper">Share text or files across devices. Expires in 12 hours.</p>

<label>Paste Text (optional)</label>
<textarea id="text" rows="4"></textarea>

<label>OR Upload File (max 50 MB)</label>
<input type="file" id="fileInput">

<div class="progress"><div id="bar"></div></div>

<button onclick="save()">Generate Code</button>

<div id="codeBox" onclick="copyCode()">Click to copy code</div>
<div class="status" id="status"></div>

<hr>

<label>Enter Code</label>
<input id="codeInput" style="text-transform:uppercase">
<button onclick="getData()">Fetch</button>

<textarea id="result" rows="4" placeholder="Text will appear here"></textarea>
<button onclick="copyText()">Copy Text</button>

<a id="downloadLink" style="display:none" target="_blank">
  <button>Download File</button>
</a>
</div>

<div id="popup" class="popup"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, serverTimestamp, Timestamp }
  from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getStorage, ref, uploadBytesResumable, getDownloadURL }
  from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";
import { getAuth, signInAnonymously }
  from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

/* ðŸ”¹ Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyAz7RGQ309YxnbdTh8UsIPx1MSXBp6JdAs",
  authDomain: "copy-paste-b7848.firebaseapp.com",
  projectId: "copy-paste-b7848",
  storageBucket: "copy-paste-b7848.firebasestorage.app",
  messagingSenderId: "1003219641375",
  appId: "1:1003219641375:web:937115921bd59051f3a12a"
};

/* ðŸ”¹ Init Firebase */
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(
  app,
  "gs://copy-paste-b7848.firebasestorage.app"
);

const auth = getAuth(app);

/* ðŸ”¹ Anonymous Auth (REQUIRED) */
await signInAnonymously(auth);
console.log("Anonymous auth success");
window.copyCode = () => {
  const code = document.getElementById("codeBox").textContent.trim();
  if (!code) return;
  navigator.clipboard.writeText(code);
  showPopup("Code copied");
};

/* ðŸ”¹ Helpers */
function showPopup(msg, error=false){
  const p = document.getElementById("popup");
  p.textContent = msg;
  p.className = "popup" + (error ? " error" : "");
  p.style.display = "block";
  setTimeout(()=>p.style.display="none",2500);
}

function genCode(){
  const c="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  return Array.from({length:6},()=>c[Math.floor(Math.random()*c.length)]).join("");
}

/* ðŸ”¹ SAVE */
window.save = async () => {
  const text = document.getElementById("text").value.trim();
  const file = document.getElementById("fileInput").files[0];
  const bar = document.getElementById("bar");
  const status = document.getElementById("status");

  if (!text && !file) return showPopup("Add text or file", true);
  if (file && file.size > 50 * 1024 * 1024) return showPopup("Max 50MB", true);

  bar.style.width = "0%";
  status.textContent = "Uploading...";

  const code = genCode();
  const expiresAt = Timestamp.fromDate(new Date(Date.now() + 12*60*60*1000));
  let data = { createdAt: serverTimestamp(), expiresAt };

  if (file) {
    const fileRef = ref(storage, `files/${code}/${file.name}`);
    const task = uploadBytesResumable(fileRef, file);

    await new Promise((resolve, reject) => {
      task.on("state_changed",
        s => bar.style.width = (s.bytesTransferred / s.totalBytes * 100) + "%",
        e => reject(e),
        async () => {
          data.type = "file";
          data.fileName = file.name;
          data.fileUrl = await getDownloadURL(task.snapshot.ref);
          resolve();
        }
      );
    });
  }

  if (text) {
    data.type = data.type || "text";
    data.text = text;
  }

  await setDoc(doc(db,"clipboard",code),data);

  document.getElementById("codeBox").textContent = code;
  status.textContent = "Done";
  showPopup("Upload successful");
};

/* ðŸ”¹ FETCH */
window.getData = async () => {
  const code = document.getElementById("codeInput").value.trim().toUpperCase();
  const snap = await getDoc(doc(db,"clipboard",code));
  if(!snap.exists()) return showPopup("Invalid / expired", true);

  const d = snap.data();
  document.getElementById("result").value = d.text || "";

  const a = document.getElementById("downloadLink");
  if(d.fileUrl){
    a.href = d.fileUrl;
    a.style.display = "block";
  }
  showPopup("Fetched successfully");
};

/* ðŸ”¹ COPY */
window.copyText = () => {
  const t = document.getElementById("result").value;
  if(t){ navigator.clipboard.writeText(t); showPopup("Copied"); }
};
</script>
</body>
</html>
